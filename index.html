<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>KILL STARS ULTIMATE</title>
    <style>
        :root {
            --gold: #ffcc00;
            --dark-green: #1a4d2e;
            --ui-bg: rgba(0, 0, 0, 0.6);
        }
        
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; font-family: 'Arial Black', sans-serif; 
            background: #000; touch-action: none;
        }

        /* Orientierungs-Check */
        #rotate-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #121212; color: white; z-index: 1000;
            flex-direction: column; align-items: center; justify-content: center;
            text-align: center;
        }
        @media (orientation: portrait) {
            #rotate-overlay { display: flex; }
        }

        /* Lobby Design */
        #lobby {
            position: absolute; width: 100%; height: 100%;
            background: radial-gradient(circle, #2d5a43 0%, #0f2016 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 100; transition: opacity 0.5s;
        }

        .logo {
            font-size: 60px; color: var(--gold);
            text-shadow: 0 5px 0 #b45f06, 0 10px 20px rgba(0,0,0,0.5);
            margin-bottom: 10px; transform: skew(-5deg);
        }

        .brawler-preview {
            width: 150px; height: 150px; background: #4a8c6f;
            border: 6px solid white; border-radius: 30px;
            display: flex; align-items: center; justify-content: center;
            font-size: 80px; box-shadow: 0 15px 30px rgba(0,0,0,0.4);
            margin-bottom: 40px; animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        #playBtn {
            padding: 20px 80px; font-size: 32px; background: #ffcc00;
            border: none; border-bottom: 8px solid #cc8800; border-radius: 50px;
            color: #332200; cursor: pointer; font-weight: bold;
            text-transform: uppercase; transition: 0.1s;
        }

        #playBtn:active { transform: scale(0.95); border-bottom-width: 2px; }

        /* HUD & Joysticks */
        #hud {
            position: absolute; top: 0; left: 0; width: 100%; padding: 20px;
            pointer-events: none; display: flex; justify-content: space-between;
            box-sizing: border-box; z-index: 50;
        }

        .stat-box {
            background: var(--ui-bg); padding: 10px 20px;
            border-radius: 15px; border: 2px solid rgba(255,255,255,0.2);
            color: white; font-size: 20px;
        }

        #hp-container { width: 250px; height: 30px; background: #333; border: 3px solid #fff; border-radius: 20px; overflow: hidden; }
        #hp-bar { width: 100%; height: 100%; background: linear-gradient(to bottom, #2ecc71, #27ae60); transition: width 0.3s; }

        .joystick {
            position: absolute; bottom: 50px; width: 140px; height: 140px;
            background: rgba(255,255,255,0.1); border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%; pointer-events: none;
        }
        #joy-left { left: 60px; }
        #joy-right { right: 60px; }
        .knob {
            position: absolute; top: 35px; left: 35px; width: 70px; height: 70px;
            background: radial-gradient(circle, #fff, #ccc); border-radius: 50%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        #game-canvas { display: block; background: #3c7a5a; }

        /* Game Over */
        #game-over {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 200;
            flex-direction: column; align-items: center; justify-content: center; color: white;
        }
    </style>
</head>
<body>

    <div id="rotate-overlay">
        <div style="font-size: 60px;">ðŸ”„</div>
        <h2>Bitte das Handy drehen</h2>
        <p>Dieses Spiel wird im Querformat gespielt!</p>
    </div>

    <div id="lobby">
        <div class="logo">KILL STARS</div>
        <div class="brawler-preview">ðŸ¤ </div>
        <button id="playBtn">STARTEN</button>
    </div>

    <div id="hud" style="display: none;">
        <div class="stat-box">Score: <span id="scoreVal">0</span></div>
        <div id="hp-container"><div id="hp-bar"></div></div>
    </div>

    <div class="joystick" id="joy-left" style="display: none;"><div class="knob" id="knob-left"></div></div>
    <div class="joystick" id="joy-right" style="display: none;"><div class="knob" id="knob-right"></div></div>

    <canvas id="game-canvas"></canvas>

    <div id="game-over">
        <h1 style="font-size: 60px; color: #e74c3c;">ELIMINIERT!</h1>
        <h2 id="final-score">Punkte: 0</h2>
        <button id="playBtn" onclick="location.reload()" style="background: #fff;">NOCHMAL</button>
    </div>

    <script>
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const lobby = document.getElementById('lobby');
        const hud = document.getElementById('hud');
        const hpBar = document.getElementById('hp-bar');
        const scoreVal = document.getElementById('scoreVal');
        
        let gameActive = false;
        let score = 0;
        let particles = [];
        let enemies = [];
        let bullets = [];
        let frame = 0;

        const player = {
            x: 0, y: 0, r: 30, hp: 100, maxHp: 100, speed: 6,
            color: '#3498db', angle: 0
        };

        // Touch Tracking
        let touchData = { left: null, right: null };
        let moveDir = { x: 0, y: 0 };
        let shootDir = { x: 0, y: 0 };

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            player.x = canvas.width / 2;
            player.y = canvas.height / 2;
        }
        window.addEventListener('resize', resize);
        resize();

        // --- STEUERUNG ---
        window.addEventListener('touchstart', e => {
            for(let t of e.changedTouches) {
                if(t.clientX < canvas.width/2) touchData.left = t;
                else touchData.right = t;
            }
        }, {passive: false});

        window.addEventListener('touchmove', e => {
            e.preventDefault();
            for(let t of e.changedTouches) {
                if(touchData.left && t.identifier === touchData.left.identifier) {
                    let dx = t.clientX - 130; // Joy-Center X
                    let dy = t.clientY - (canvas.height - 120); // Joy-Center Y
                    let dist = Math.hypot(dx, dy);
                    let max = 60;
                    moveDir.x = (dx / dist) * Math.min(dist/max, 1);
                    moveDir.y = (dy / dist) * Math.min(dist/max, 1);
                    document.getElementById('knob-left').style.transform = `translate(${moveDir.x*40}px, ${moveDir.y*40}px)`;
                }
                if(touchData.right && t.identifier === touchData.right.identifier) {
                    let dx = t.clientX - (canvas.width - 130);
                    let dy = t.clientY - (canvas.height - 120);
                    let dist = Math.hypot(dx, dy);
                    shootDir.x = dx / dist;
                    shootDir.y = dy / dist;
                    document.getElementById('knob-right').style.transform = `translate(${shootDir.x*40}px, ${shootDir.y*40}px)`;
                }
            }
        }, {passive: false});

        window.addEventListener('touchend', e => {
            for(let t of e.changedTouches) {
                if(touchData.left && t.identifier === touchData.left.identifier) {
                    touchData.left = null; moveDir = {x:0, y:0};
                    document.getElementById('knob-left').style.transform = `translate(0,0)`;
                }
                if(touchData.right && t.identifier === touchData.right.identifier) {
                    touchData.right = null; shootDir = {x:0, y:0};
                    document.getElementById('knob-right').style.transform = `translate(0,0)`;
                }
            }
        });

        // --- GRAFIK FUNKTIONEN ---
        function drawShadow(x, y, r) {
            ctx.fillStyle = 'rgba(0,0,0,0.2)';
            ctx.beginPath();
            ctx.ellipse(x, y + r*0.8, r, r/3, 0, 0, Math.PI*2);
            ctx.fill();
        }

        function createParticles(x, y, color) {
            for(let i=0; i<8; i++) {
                particles.push({
                    x, y, vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10,
                    life: 1.0, color: color, size: Math.random()*5+2
                });
            }
        }

        // --- GAME LOOP ---
        document.getElementById('playBtn').onclick = () => {
            lobby.style.display = 'none';
            hud.style.display = 'flex';
            document.querySelectorAll('.joystick').forEach(j => j.style.display = 'block');
            gameActive = true;
            loop();
        };

        function loop() {
            if(!gameActive) return;
            frame++;

            // Hintergrund
            ctx.fillStyle = '#3c7a5a';
            ctx.fillRect(0,0,canvas.width, canvas.height);
            
            // Spieler Bewegung
            player.x += moveDir.x * player.speed;
            player.y += moveDir.y * player.speed;
            
            // SchieÃŸen
            if(touchData.right && frame % 10 === 0) {
                bullets.push({x: player.x, y: player.y, vx: shootDir.x*12, vy: shootDir.y*12});
            }

            // Partikel
            particles.forEach((p, i) => {
                p.x += p.vx; p.y += p.vy; p.life -= 0.02;
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, p.size, p.size);
                if(p.life <= 0) particles.splice(i, 1);
            });
            ctx.globalAlpha = 1;

            // Gegner Logik
            if(frame % Math.max(20, 60 - Math.floor(score/50)) === 0) {
                enemies.push({
                    x: Math.random()*canvas.width, y: -50, 
                    r: 25, hp: 30, speed: 2 + (score/200)
                });
            }

            enemies.forEach((e, ei) => {
                let ang = Math.atan2(player.y - e.y, player.x - e.x);
                e.x += Math.cos(ang) * e.speed;
                e.y += Math.sin(ang) * e.speed;
                
                drawShadow(e.x, e.y, e.r);
                ctx.fillStyle = '#e74c3c';
                ctx.beginPath(); ctx.arc(e.x, e.y, e.r, 0, Math.PI*2); ctx.fill();
                
                // Treffer Check
                bullets.forEach((b, bi) => {
                    if(Math.hypot(e.x-b.x, e.y-b.y) < e.r) {
                        e.hp -= 10;
                        bullets.splice(bi, 1);
                        createParticles(e.x, e.y, '#c0392b');
                        if(e.hp <= 0) {
                            enemies.splice(ei, 1);
                            score += 10;
                            scoreVal.innerText = score;
                        }
                    }
                });

                // Spieler Schaden
                if(Math.hypot(e.x-player.x, e.y-player.y) < e.r + player.r) {
                    player.hp -= 0.5;
                    hpBar.style.width = player.hp + "%";
                    if(player.hp <= 0) {
                        gameActive = false;
                        document.getElementById('game-over').style.display = 'flex';
                        document.getElementById('final-score').innerText = "Punkte: " + score;
                    }
                }
            });

            // Projektile zeichnen
            bullets.forEach((b, i) => {
                b.x += b.vx; b.y += b.vy;
                ctx.fillStyle = '#f1c40f';
                ctx.beginPath(); ctx.arc(b.x, b.y, 8, 0, Math.PI*2); ctx.fill();
                if(b.x < 0 || b.x > canvas.width || b.y < 0 || b.y > canvas.height) bullets.splice(i, 1);
            });

            // Spieler zeichnen
            drawShadow(player.x, player.y, player.r);
            ctx.fillStyle = player.color;
            ctx.beginPath(); ctx.arc(player.x, player.y, player.r, 0, Math.PI*2); ctx.fill();
            ctx.strokeStyle = 'white'; ctx.lineWidth = 3; ctx.stroke();

            requestAnimationFrame(loop);
        }
    </script>
</body>
</html>
